<div class="app-container" [class.collapsed]="sidebarCollapsed"
  *ngIf="isAuthenticated && !isLoginRoute; else authLayout">
  <!-- Header -->
  <header class="app-header">
    <div class="header-left">
      <button class="menu-toggle" (click)="toggleSidebar()">
        <i class="pi pi-bars"></i>
      </button>
      <h2 class="app-title">Employee Onboarding</h2>
    </div>

    <div class="header-right">
      <!-- Notifications -->
      <app-notification-panel></app-notification-panel>

      <!-- User Menu -->
      <div class="user-menu">
        <button class="user-button" (click)="userMenuVisible = !userMenuVisible">
          <i class="pi pi-user"></i>
          <span>{{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>
          <i class="pi pi-chevron-down"></i>
        </button>

        <div class="user-dropdown" *ngIf="userMenuVisible">
          <button (click)="logout()">
            <i class="pi pi-sign-out"></i>
            Logout
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar Navigation -->
  <aside class="app-sidebar" [class.collapsed]="sidebarCollapsed">
    <nav class="sidebar-nav">
      <!-- Admin/HR Menu (Role 1) -->
      <ng-container *ngIf="isHR || isAdmin">
        <a routerLink="/dashboard" routerLinkActive="active" class="nav-link">
          <i class="pi pi-home"></i>
          <span>Dashboard</span>
        </a>
        <a routerLink="/employees" routerLinkActive="active" class="nav-link">
          <i class="pi pi-users"></i>
          <span>Employee Management</span>
        </a>
        <a routerLink="/tasks" routerLinkActive="active" class="nav-link">
          <i class="pi pi-list"></i>
          <span>Task Management</span>
        </a>
        <a routerLink="/task-templates" routerLinkActive="active" class="nav-link">
          <i class="pi pi-file-edit"></i>
          <span>Task Templates</span>
        </a>
        <a routerLink="/documents" routerLinkActive="active" class="nav-link">
          <i class="pi pi-folder"></i>
          <span>Document Center</span>
        </a>
        <a routerLink="/reports" routerLinkActive="active" class="nav-link">
          <i class="pi pi-chart-bar"></i>
          <span>Reports</span>
        </a>
        <a routerLink="/admin/users" routerLinkActive="active" class="nav-link">
          <i class="pi pi-user-edit"></i>
          <span>Users & Roles</span>
        </a>
        <a routerLink="/admin/settings" routerLinkActive="active" class="nav-link">
          <i class="pi pi-cog"></i>
          <span>System Settings</span>
        </a>
        <a routerLink="/admin/activity-logs" routerLinkActive="active" class="nav-link">
          <i class="pi pi-history"></i>
          <span>Activity Logs</span>
        </a>
      </ng-container>

      <!-- Employee Menu (Role 3) -->
      <ng-container *ngIf="isEmployee">
        <a routerLink="/employee/dashboard" routerLinkActive="active" class="nav-link">
          <i class="pi pi-home"></i>
          <span>Dashboard</span>
        </a>
        <a routerLink="/my-tasks" routerLinkActive="active" class="nav-link">
          <i class="pi pi-list"></i>
          <span>My Tasks</span>
        </a>
        <a routerLink="/my-documents" routerLinkActive="active" class="nav-link">
          <i class="pi pi-folder"></i>
          <span>My Documents</span>
        </a>
        <a routerLink="/employee/summary" routerLinkActive="active" class="nav-link">
          <i class="pi pi-file-pdf"></i>
          <span>Onboarding Summary</span>
        </a>
      </ng-container>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="app-content">
    <router-outlet></router-outlet>
  </main>
</div>

<ng-template #authLayout>
  <router-outlet></router-outlet>
</ng-template>

<p-toast position="top-right"></p-toast>

<!-- Force Password Change Dialog -->
<app-change-password-dialog [(visible)]="showPasswordChangeDialog"
  (passwordChanged)="onPasswordChanged()"></app-change-password-dialog>